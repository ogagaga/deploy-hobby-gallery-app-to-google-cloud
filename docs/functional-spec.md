# Hobby Gallery 機能仕様書

このドキュメントでは、Hobby Gallery アプリケーションの機能仕様について記述します。

## 1. アプリケーション概要

プラモデルや模型の完成品写真を管理・展示するためのギャラリーアプリケーションです。
シンプルながらもモダンなデザインを特徴とし、制作データの詳細な管理が可能です。
Framer Motion による高級感のあるアニメーションと、直感的な操作性を追求しています。

## 2. 共通機能・UX

### 2.1 ページ遷移アニメーション
- **演出**: 全ページに共通して、コンテンツが下から浮き上がりながらフェードインするアニメーションを適用。
- **UX**: ページ切り替え時の「高級感」と「滑らかさ」を提供し、アプリ全体の統一感を演出。

### 2.2 マイクロインタラクション
- **インタラクティブなボタン**: クリック（タップ）時のわずかな沈み込みと、ホバー時の滑らかな微拡大（Scale変化）を実装。
- **入力フィードバック**: フォーム入力欄へのフォーカス時に、ダイナミックに広がるリング演出（Glow効果）を追加。
- **視覚的フィードバック**: ボタンやリンクのホバー時に、質感を感じさせる色の遷移とスケール調整を適用。

### 2.5 プレミアム・エラーページ
- **404 Not Found**: 模型の箱をモチーフにしたビジュアルと、「展示品が見つからなかった」というギャラリーの文脈に沿ったメッセージを表示。
- **500 Server Error**: 「搬入トラブル」という柔らかな表現と、再試行ボタンによるシームレスな復旧手段を提供。
- **UX**: 予期せぬ状況でもアプリケーションの品質を損なわず、ユーザーを適切にTOPページへ誘導。

### 2.6 ビルド・ログ（リッチテキスト対応）
- **Markdown**: 製作のこだわり（ビルド・ログ）をマークダウン形式で記述可能。見出し、太字、リスト、リンクなどが利用でき、ドキュメントとしての品質を向上。
- **リアルタイムプレビュー**: 投稿・編集画面にエディタとプレビューの切り替えタブを搭載。公開前に仕上がりを即座に確認可能。
- **Typography設計**: 詳細画面では `prose` スタイルを採用し、模型雑誌の記事のような高品質な読み心地を提供。

## 3. 画面一覧・機能

### 3.1 ギャラリー一覧画面 (TOP)
- **URL**: `/`
- **主要機能**:
  - 投稿された作品の新着順一覧表示。
  - **スケルトン表示**: 初回アクセス時やデータフェッチ中、実際の作品カードと同じアスペクト比（4:3）のプレースホルダーを表示。
  - **プレミアム作品カード**:
    - **シャインエフェクト**: カードをホバーした際、表面を光が走り抜ける演出。
    - **VIEW DETAILS**: ホバー時に写真上に詳細へのリンクがアニメーションと共に浮上。
    - **画像ズーム**: ホバー時にメイン画像が枠内で微細に拡大。
  - **スタッガーアニメーション**: リスト表示時に各カードが時間差でアニメーション表示。
  - 管理者権限（ADMIN_EMAIL 一致）による「作品を投稿」ボタンの表示。
  - **グローバル・ヘッダー**: 
    - **スクロール進捗バー**: 閲覧位置を視覚化するバーを最上部に表示。
    - **動的スタイリング**: スクロールに応じてヘッダーが透明からグラスモーフィズム（ぼかし）へ変化。

### 3.2 作品詳細画面
- **URL**: `/works/[id]`
- **主要機能**:
  - 作品の全情報の閲覧。
  - **制作データ**: キット名、メーカー、スケール、ジャンル、使用塗料・マテリアル。
  - **説明文**: 制作のポイントや改造点などの自由記述。
  - **サブ写真ギャラリー**: メイン画像以外の追加写真をグリッド形式で閲覧。
  - **管理者機能**: ログイン中の管理者にのみ「編集」および「削除」ボタンを表示。

### 3.3 作品投稿・編集画面 (要管理者ログイン)
- **URL**: `/works/new`, `/works/[id]/edit`
- **主要機能**:
  - **画像アップロード**: メイン写真（必須）および複数枚のサブ写真。
  * **画像最適化 (クライアントサイド圧縮)**: モバイル環境等からのアップロードを高速化するため、送信前にブラウザ側でリサイズ（最大1920px）および容量圧縮（最大1MB目安）を自動実行。
  * **複数サブ写真管理**: 投稿・編集の両方で、複数回に分けた写真追加が可能。
  - **ドラッグ＆ドロップによる順序変更**: Framer Motion `Reorder` を使用し、サブ画像の表示順を直感的に入れ替え可能。この順序は作品詳細ページに反映される。
  - **タグ自動補完**: 既存のタグからサジェストを表示し、スムーズな入力を支援。
  * **データ同期**: 編集画面では既存の作品情報（画像、タグ、制作データ）を初期値として読み込み。
  - **詳細なフィードバック**: バリデーションエラー発生時、入力項目ごとに具体的なエラーメッセージ（例：「タイトルは100文字以内で入力してください」）をリアルタイムに表示。
  - **送信中演出**: フォーム送信時に、ボタン内にローディングアニメーションを表示し、多重送信を防止しながら処理状況を提示。

### 3.4 ウェルカム・紹介画面
- **URL**: `/welcome`
- **主要機能**:
  - アプリケーションのコンセプトや使用方法の紹介。
  - 初回アクセス時や「サイトについて」クリック時に表示。

## 4. データモデル (Prisma Schema)

### 4.1 Work (作品主体)
| フィールド | 内容 |
| :--- | :--- |
| title | 作品タイトル (100文字以内、必須) |
| kitName | 使用したキット名 (100文字以内) |
| maker | 模型メーカー名 (100文字以内) |
| scale | スケール (50文字以内) |
| genre | 模型のジャンル (50文字以内) |
| paints | 使用塗料・マテリアルの詳細 (1000文字以内) |
| description | 制作のポイントやストーリー (5000文字以内) |
| mainImage | メイン写真の保存先URL (必須) |

- 1つの Work に対して複数の画像を紐付け可能 (1:N)。
- **order フィールド**: 各画像の表示順序を保持し、ドラッグ＆ドロップ操作と同期。

### 4.3 Tag (タグ)
- 作品に複数のタグを付与可能 (N:M)。
- 重複を防ぐため名前でユニーク管理。

## 5. 堅牢なバリデーションとセキュリティ

### 5.1 サーバーサイド検証
- **Zod による検証**: 全ての Server Actions で `zod` スキーマを使用した厳格なデータ検証を実施。不正なデータ形式や極端に長い文字列をデータベース到達前に遮断します。
- **認可チェック**: `checkAdmin` ヘルパーにより、管理者権限が必要な操作を確実にガード。

### 5.2 画像の安全な取り扱い
- **EXIF メタデータの完全削除**: アップロード時にサーバー側で画像から位置情報 (GPS) や撮影機器情報などのメタデータを完全に除去。プライバシー漏洩を防止します。
- **向きの自動補正**: EXIF の Orientation 情報を読み取り、画像を正しい向きに回転させてから保存。メタデータ削除後の表示不整合を防ぎます。
- **整合性チェック**: ファイルサイズ（最大5MB）と MIME タイプの検証により、不正なファイル形式のアップロードを防止。

## 6. 認可・制限事項

- **管理者権限**:
  - `process.env.ADMIN_EMAIL` と一致する Google アカウントに対して、投稿・追加・編集の全権限を付与。
  - サーバーアクション実行時に毎回電子メールによる一致確認を実施。
- **一般ユーザー (閲覧者)**:
  - 作品の閲覧（一覧・詳細）のみ可能. 投稿や編集ボタンは非表示。
- **技術制約**:
  - **Prisma バージョン**: v6.19.2 に固定。
  - **画像アップロード制限**:
    - ファイルサイズ: 1枚につき最大 5MB。
    - 許可形式: JPG, JPEG, PNG, WebP。
  - **画像圧縮**: `browser-image-compression` を使用し、Web Worker 上で非同期に処理。
  - **Client Component 隔離**: Framer Motion 使用部品は `use client` ディレクティブにより隔離。
