# Google認証の設定手順

Hobby GalleryでGoogle認証を有効にするための手順です。
Google Cloud Consoleでの設定は、**「① 同意画面の設定」を完了してから「② 認証情報の作成」を行う**必要があります。

## 1. Google Cloud Console での設定（詳細）

### 1.1 プロジェクトの作成
1. [Google Cloud Console](https://console.cloud.google.com/) にアクセスします。
2. 画面左上のプロジェクト名（または「プロジェクトを選択」）をクリックし、**「新しいプロジェクト」** を作成します。
3. プロジェクト名（例: `Hobby Gallery`）を入力し、「作成」をクリックします。

### 1.2 OAuth 同意画面の設定（必須：最初に行う）
認証情報を作成する前に、ユーザーに表示される同意画面を設定する必要があります。
1. 左メニューの **「APIとサービス」 > 「OAuth 同意画面」** をクリックします。
2. **User Type** で **「外部」** を選択し、「作成」をクリックします。
3. **アプリ情報** を入力します（以下の項目以外は未入力でOK）。
   - **アプリ名**: `Hobby Gallery`
   - **ユーザーサポートメール**: 自身のメールアドレスを選択
   - **デベロッパーの連絡先情報**: 自身のメールアドレスを入力
4. 「保存して次へ」をクリックします。
5. **スコープ**: 何も変更せず「保存して次へ」をクリックします。
6. **テストユーザー**: 自分自身でログインするために追加が必要です。
   - 「+ ADD USERS」をクリックし、**ログインに使用する自分のGoogleメールアドレス**を入力して「追加」します。
7. 「保存して次へ」をクリックし、最後に「ダッシュボードに戻る」をクリックします。

### 1.3 認証情報 (Client ID) の作成
1. 左メニューの **「APIとサービス」 > 「認証情報」** をクリックします。
2. 上部の **「+ 認証情報を作成」 > 「OAuth クライアント ID」** を選択します。
3. **アプリケーションの種類** で **「ウェブ アプリケーション」** を選択します。
4. **名前** に `Hobby Gallery (Local)` などと入力します。
5. **承認済みの転送 URI** の下にある「+ URI を追加」をクリックし、以下を正確に入力します。
   - `http://localhost:3000/api/auth/callback/google`
   - **注意**: 最後に余計なスペースが入らないようにしてください。
6. 「作成」をクリックします。
7. ポップアップで表示される **「クライアント ID」** と **「クライアント シークレット」** をコピーして、安全な場所にメモしておきます。

## 2. 環境変数の設定

プロジェクトのルートディレクトリに `.env.local` ファイルを作成し、控えた値を設定します。

```env
# Google Cloud Console で取得した値
AUTH_GOOGLE_ID=あなたのクライアントID
AUTH_GOOGLE_SECRET=あなたのクライアントシークレット

# NextAuth 用のシークレット（ターミナルで npx auth secret を実行して生成）
AUTH_SECRET=生成されたシークレット文字列

# 管理者としてログインを許可するメールアドレス（上記テストユーザーと同じものを推奨）
ADMIN_EMAIL=あなたのメールアドレス@gmail.com
```

## 3. アプリの起動

ターミナルで以下のコマンドを実行します。

### ローカル（npm）で直接起動する場合
```bash
npm install
npm run dev
```

### Dockerを使用する場合
```bash
docker compose up -d
```

起動後、 [http://localhost:3000](http://localhost:3000) にアクセスし、「Googleでログイン」ボタンからログインできるか確認してください。

---

### 注意事項
- **Google Fontsの無効化**: 現在、一部の開発環境で発生するTLS接続エラー（Turbopackの制限）を回避するため、`src/app/layout.tsx` において Google Fonts の読み込みを一時的にコメントアウトしています。画面デザインが標準フォントになりますが、動作には影響ありません。
